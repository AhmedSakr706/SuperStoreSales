DELETE FROM superstore 
WHERE Country = "Country" ;

ALTER TABLE superstore 
ADD COLUMN id INT PRIMARY KEY NOT NULL AUTO_INCREMENT ; 


-- cleaning data 

-- check for duplicated values 
SELECT order_id, customer_id, customer_name, product_id, product_name, COUNT(*)
FROM superstore
GROUP BY order_id, customer_id, customer_name, product_id, product_name
HAVING COUNT(*) > 1;




-- show duplicated data

SELECT a.*
FROM superstore a
JOIN (
    SELECT order_id, customer_id, customer_name, product_id, product_name
    FROM superstore
    GROUP BY order_id, customer_id, customer_name, product_id, product_name
    HAVING COUNT(*) > 1
) b ON a.order_id = b.order_id
    AND a.customer_id = b.customer_id
    AND a.customer_name = b.customer_name
    AND a.product_id = b.product_id
    AND a.product_name = b.product_name;




-- remove duplicated values 
DELETE t1 FROM superstore t1
  JOIN (
    SELECT MIN(id) AS min_id, order_id, customer_id, customer_name, product_id, product_name
    FROM superstore
    GROUP BY order_id, customer_id, customer_name, product_id, product_name
  ) t2
  ON t1.order_id = t2.order_id
  AND t1.customer_id = t2.customer_id
  AND t1.customer_name = t2.customer_name
  AND t1.product_id = t2.product_id
  AND t1.product_name = t2.product_name
  WHERE t1.id > t2.min_id;





-- Format Profit & Sales Columns 

UPDATE superstore
SET
  sales = CASE
    WHEN sales LIKE '($%)' THEN -1 * CAST(REPLACE(REPLACE(REPLACE(sales, '(', ''), ')', ''), '$', '') AS DECIMAL(10, 2))
    ELSE CAST(REPLACE(REPLACE(sales, '$', ''), ',', '') AS DECIMAL(10, 2))
  END,
  profit = CASE
    WHEN profit LIKE '($%)' THEN -1 * CAST(REPLACE(REPLACE(REPLACE(profit, '(', ''), ')', ''), '$', '') AS DECIMAL(10, 2))
    ELSE CAST(REPLACE(REPLACE(profit, '$', ''), ',', '') AS DECIMAL(10, 2))
  END
WHERE sales LIKE '$%' OR sales LIKE '($%)' OR profit LIKE '$%' OR profit LIKE '($%)';




-- prepare data


ALTER TABLE superstore
ADD COLUMN Transportaion_time INT ;

UPDATE superstore
SET Transportation_time = CASE
                    WHEN order_date IS NULL OR Ship_date IS NULL THEN NULL
                    ELSE DATEDIFF(STR_TO_DATE(Ship_date, '%m/%d/%Y'), STR_TO_DATE(order_date, '%m/%d/%Y'))
                END;


-- ADD Column called Number_of_times_customer_purchases

ALTER TABLE superstore
ADD COLUMN Number_of_times_customer_purchases INT;

UPDATE superstore a
INNER JOIN (
    SELECT customer_id, customer_name, COUNT(*) as cnt
    FROM superstore
    GROUP BY customer_id, customer_name
) b ON a.customer_id = b.customer_id AND a.customer_name = b.customer_name
SET a.Number_of_times_customer_purchases = b.cnt;


SELECT * FROM `superstore` 
ORDER BY Number_of_times_customer_purchases DESC;



-- Split Product_Name for Two columns 

ALTER TABLE superstore
ADD COLUMN Product_Name_Part1 VARCHAR(100);

ALTER TABLE superstore
ADD COLUMN Product_Type VARCHAR(100);


UPDATE superstore
SET Product_Name_Part1 = SUBSTRING_INDEX(Product_Name, ',', 1);

UPDATE superstore
SET Product_Type = SUBSTRING_INDEX(Product_Name, ',', -1);



-- ADD Column Percentage_Of_Profit 

ALTER TABLE superstore 
ADD COLUMN `Percentage_Of_Profit` DECIMAL(10,2);

UPDATE superstore 
SET Percentage_Of_Profit = Profit / Sales ;

